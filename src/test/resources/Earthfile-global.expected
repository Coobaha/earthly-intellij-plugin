[COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]PROTOC_VERSION = 3.15.8[LINE_BREAK->]
[LINE_BREAK->]
[COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]ubuntu:22.04[LINE_BREAK->]
[COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]apt-get update && apt-get install -y wget unzip[LINE_BREAK->]
[COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]wget -O protoc.zip https://github.com/protocolbuffers/protobuf/releases/download/v$PROTOC_VERSION/protoc-$PROTOC_VERSION-linux-x86_64.zip[LINE_BREAK->]
[COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]unzip protoc.zip -d /usr/local/[LINE_BREAK->]
[LINE_BREAK->]
[COMMENT->]###### Global[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]publish-build:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ENV[WHITE_SPACE->] [COMMAND_ARG->]DEBIAN_FRONTEND=noninteractive[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]BUILD[WHITE_SPACE->] [TARGET_REF->]+publish-java[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]publish-release:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ENV[WHITE_SPACE->] [COMMAND_ARG->]DEBIAN_FRONTEND=noninteractive[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]BUILD[WHITE_SPACE->] [COMMAND_OPTION->]--build-arg[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]version=$version[WHITE_SPACE->] [TARGET_REF->]+publish-release-java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]BUILD[WHITE_SPACE->] [COMMAND_OPTION->]--build-arg[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]version=$version[WHITE_SPACE->] [TARGET_REF->]+publish-release-grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]BUILD[WHITE_SPACE->] [COMMAND_OPTION->]--build-arg[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]version=$version[WHITE_SPACE->] [TARGET_REF->]+publish-release-python[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]release:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+publish-release[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]apt-get install -y git[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]WORKDIR[WHITE_SPACE->] [COMMAND_ARG->]/tmp[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]+build-release-java/java /api/java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]+build-release-python/python /api/python[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]ghuser=+secrets/ghuser[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]ghtoken=+secrets/ghtoken[WHITE_SPACE->] [COMMAND_ARG->]git clone https://$ghuser:$ghtoken@github.com/foo/api.git;[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cp -rf /api/java/* api/java/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cp -rf /api/python/* api/python/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd api; git config user.name "foo CI/CD"; git config user.email "dev@foo.io"[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd api; git checkout -b release/$version; git add *; git commit -m "release $version"; git push --set-upstream origin release/$version; git tag v$version; git push origin v$version; git push origin --delete release/$version[LINE_BREAK->]
[LINE_BREAK->]
[COMMENT->]###### gRPC-web[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]setup-grpc-web:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ENV[WHITE_SPACE->] [COMMAND_ARG->]DEBIAN_FRONTEND=noninteractive[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]apt-get install -y nodejs npm[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]wget https://github.com/grpc/grpc-web/releases/download/$PROTOC_GEN_GRPC_WEB_VERSION/protoc-gen-grpc-web-$PROTOC_GEN_GRPC_WEB_VERSION-linux-x86_64 -O /tmp/protoc-gen-grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]mv /tmp/protoc-gen-grpc-web /usr/local/bin/protoc-gen-grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]chmod +x /usr/local/bin/protoc-gen-grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]npm install -g typescript[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]npm set registry "https://npm.pkg.github.com"[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]ghtoken=+secrets/ghtoken[WHITE_SPACE->] [COMMAND_ARG->]npm set //npm.pkg.github.com/:_authToken $ghtoken[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]build-release-grpc-web:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+setup-grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]grpc-web /api/grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]protobuf /api/protobuf[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]WORKDIR[WHITE_SPACE->] [COMMAND_ARG->]/api/grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]mkdir dist[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]protoc --proto_path=/api/protobuf -I=. /api/protobuf/*.proto --js_out=import_style=commonjs:dist --grpc-web_out=import_style=commonjs+dts,mode=grpcwebtext:dist && ls -la dist[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]sed -i -e 's/0.0.1/'$version'/g' ./package.json[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cp ./*.ts dist/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]npm run build[LINE_BREAK->]
[COMMENT->]# RUN rm -rf dist/Factory.ts dist/index.ts[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cp ./package.json dist/package.json[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/grpc-web/dist [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/grpc-web[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]publish-release-grpc-web:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+build-release-grpc-web[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd dist && npm publish --verbose[LINE_BREAK->]
[LINE_BREAK->]
[COMMENT->]###### Java[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]prepare-java:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ENV[WHITE_SPACE->] [COMMAND_ARG->]DEBIAN_FRONTEND=noninteractive[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]apt-get install -y default-jre maven[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]java /api/java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]protobuf /api/protobuf[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]WORKDIR[WHITE_SPACE->] [COMMAND_ARG->]/api/java[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]build-java:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+prepare-java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--mount[COMMAND_OPTION_EQUALS->]=[COMMAND_OPTION_VALUE->]type=cache,target=/root/.m2/repository[WHITE_SPACE->] [COMMAND_ARG->]mvn clean install[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/java/commons/target/*.jar [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/java/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/java/proto/target/*.jar [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/java/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/java/client/target/*.jar [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/java/[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]publish-java:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+build-java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]github_user[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]github_token[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]java/.settings.xml /root/.m2/settings.xml[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]ghuser=+secrets/ghuser[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]"ghtoken=+secrets/ghtoken"[WHITE_SPACE->] [WHITE_SPACE->]\
 [WHITE_SPACE->] [COMMAND_OPTION->]--mount[COMMAND_OPTION_EQUALS->]=[COMMAND_OPTION_VALUE->]type=cache,target=/root/.m2/repository[WHITE_SPACE->] [COMMAND_ARG->]GITHUB_ACTOR=$ghuser GITHUB_TOKEN=$ghtoken mvn clean deploy[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]build-release-java:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+prepare-java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--mount[COMMAND_OPTION_EQUALS->]=[COMMAND_OPTION_VALUE->]type=cache,target=/root/.m2/repository[WHITE_SPACE->] [COMMAND_ARG->]mvn -B release:prepare-with-pom -DdryRun=true -DreleaseVersion=$version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd /api/java; mv pom.xml.tag _pom.xml; rm release* pom.*; mv _pom.xml pom.xml[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd /api/java/client; mv pom.xml.tag _pom.xml; rm release* rm pom.*; mv _pom.xml pom.xml[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd /api/java/commons; mv pom.xml.tag _pom.xml; rm release* rm pom.*; mv _pom.xml pom.xml[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd /api/java/proto; mv pom.xml.tag _pom.xml; rm release* rm pom.*; mv _pom.xml pom.xml[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--mount[COMMAND_OPTION_EQUALS->]=[COMMAND_OPTION_VALUE->]type=cache,target=/root/.m2/repository[WHITE_SPACE->] [COMMAND_ARG->]mvn clean install[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/java/commons/target/*.jar [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/java/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/java/proto/target/*.jar [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/java/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/java/client/target/*.jar [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./build/dist/java/[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [COMMAND_ARG->]/api/java[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]publish-release-java:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+build-release-java[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]github_user[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]github_token[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]java/.settings.xml /root/.m2/settings.xml[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]ghuser=+secrets/ghuser[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]ghtoken=+secrets/ghtoken[WHITE_SPACE->] [COMMAND_OPTION->]--mount[COMMAND_OPTION_EQUALS->]=[COMMAND_OPTION_VALUE->]type=cache,target=/root/.m2/repository[WHITE_SPACE->] [COMMAND_ARG->]GITHUB_ACTOR=$ghuser GITHUB_TOKEN=$ghtoken mvn clean deploy[LINE_BREAK->]
[LINE_BREAK->]
[COMMENT->]## Python[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]build-release-python:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]ARG[WHITE_SPACE->] [COMMAND_ARG->]version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]apt-get install -y python3 python3-pip pandoc[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]pip3 install grpcio grpcio-tools twine pypandoc[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]mkdir -p /proto/protobuf[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]protobuf/ /api/protobuf[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]python/ /api/python[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]cd /api/python; python3 -m src.gen.api_generator --base_path ./src/gen/base.py --build_path ./dist --generated_module_name bx --protobuf_path ../protobuf --package_name foo[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]echo "Version: $version"; echo $version>/api/python/dist/version[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [WHITE_SPACE->]/api/python/dist [COMMAND->]AS LOCAL[WHITE_SPACE->] [COMMAND_ARG->]./python/dist[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]SAVE ARTIFACT[WHITE_SPACE->] [COMMAND_ARG->]/api/python[LINE_BREAK->]
[LINE_BREAK->]
[TARGET->]publish-release-python:[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]+build-release-python[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_OPTION->]--secret[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]pypitoken=+secrets/pypitoken[WHITE_SPACE->] [COMMAND_ARG->]cd /api/python/dist;python3 setup.py sdist; twine upload -u=__token__ -p=$pypitoken dist/*[LINE_BREAK->]
[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]FROM[WHITE_SPACE->] [TARGET_REF->]earthly/dind:alpine[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]WORKDIR[WHITE_SPACE->] [COMMAND_ARG->]/test[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]COPY[WHITE_SPACE->] [COMMAND_ARG->]docker-compose.yml ./[LINE_BREAK->]
[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]WITH DOCKER[WHITE_SPACE->] [COMMAND_OPTION->]--load[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]image-name:latest=(+some-target --SOME_BUILD_ARG=value)[WHITE_SPACE->] [WHITE_SPACE->]\
 [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [COMMAND_OPTION->]--pull[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]some-image:latest[LINE_BREAK->]
[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]WITH DOCKER[WHITE_SPACE->] [COMMAND_OPTION->]--compose[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]docker-compose.yml[WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->]\
 [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [COMMAND_OPTION->]--load[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]image-name:latest=(+some-target --SOME_BUILD_ARG=value)[WHITE_SPACE->] [WHITE_SPACE->]\
 [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [COMMAND_OPTION->]--load[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]another-image-name:latest=+another-target[WHITE_SPACE->] [WHITE_SPACE->]\
 [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [COMMAND_OPTION->]--pull[WHITE_SPACE->] [COMMAND_OPTION_VALUE->]some-image:latest[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]RUN[WHITE_SPACE->] [COMMAND_ARG->]docker run ... && \
          docker run ... && \
          ...[LINE_BREAK->]
[WHITE_SPACE->] [WHITE_SPACE->] [COMMAND->]END